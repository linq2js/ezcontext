{"version":3,"sources":["../index.js"],"names":["create","use","selector","shallowEqual","debounce","symbolId","Date","getTime","createSymbol","Symbol","isHoc","isContext","isAction","dataProp","consumerProp","providerProp","defaultMethodCreator","$","update","CachableConsumer","props","Component","__component","React","PureComponent","createData","value","methods","render","ownedProps","args","index","contextToProps","contexts","component","context","apply","concat","x","connect","computed","computer","recomputeAndNotify","computedContext","recompute","forEach","mappedArgs","map","createContext","readonly","options","data","methodCreator","subscribers","accessor","wiredMethods","Object","entries","reduce","name","method","result","arguments","payload","length","subscriber","push","indexOf","splice","hoc","propName","assign","Consumer","state","unsubscribe","setState","Provider","children","slice","call","pop","invoke","action","createHocOrAction","contextData","compose","hocs","Wrapper","funcs","lastFunc","lastArgs","lastResult","wrapper","argSelectors","value1","value2","ignoreFuncs","Array","isArray","i","value1Prop","value2Prop","value1Keys","keys","key","interval","callback","timer","clearTimeout","setTimeout"],"mappings":"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","file":"index.js","sourcesContent":["import React, { createElement } from 'react';\r\n\r\nlet symbolId = new Date().getTime();\r\nconst createSymbol = typeof Symbol === 'undefined' ? () => symbolId++ : Symbol;\r\nconst isHoc = createSymbol('Hoc');\r\nconst isContext = createSymbol('Context');\r\nconst isAction = createSymbol('Actiion');\r\nconst dataProp = createSymbol['Data'];\r\nconst consumerProp = createSymbol('Consumer');\r\nconst providerProp = createSymbol('Provider');\r\n\r\n// create default method for context\r\nfunction defaultMethodCreator($) {\r\n  return {\r\n    update: $\r\n  };\r\n}\r\n\r\n// improve performance by using PureComponent\r\nclass CachableConsumer extends React.PureComponent {\r\n  render() {\r\n    const { __component: Component, ...props } = this.props;\r\n    return createElement(Component, props);\r\n  }\r\n}\r\n\r\nfunction createData(value, methods) {\r\n  return {\r\n    value,\r\n    ...methods\r\n  };\r\n}\r\n\r\n// render multiple context consumers\r\nfunction render(ownedProps, args, index, contextToProps, contexts, component) {\r\n  const context = contexts[index];\r\n  if (!context) {\r\n    const props = contextToProps.apply(null, [ownedProps].concat(args)) || {};\r\n    if (typeof props === 'function') {\r\n      return props(component);\r\n    }\r\n    props.__component = component;\r\n    return createElement(CachableConsumer, props);\r\n  }\r\n  return createElement(context[consumerProp], {}, x =>\r\n    render(\r\n      ownedProps,\r\n      args.concat([x]),\r\n      index + 1,\r\n      contextToProps,\r\n      contexts,\r\n      component\r\n    )\r\n  );\r\n}\r\n\r\nfunction connect(contexts, contextToProps, component) {\r\n  return function(props) {\r\n    const args = [];\r\n    return render(props, args, 0, contextToProps, contexts, component);\r\n  };\r\n}\r\n\r\n/**\r\n * create computed context\r\n */\r\nfunction computed(computer, contexts) {\r\n  const recomputeAndNotify = debounce(0, () => {\r\n    computedContext(recompute());\r\n  });\r\n  computer = selector(computer);\r\n  contexts.forEach(context => context(recomputeAndNotify));\r\n\r\n  function recompute() {\r\n    const mappedArgs = contexts.map(context => context());\r\n    return computer.apply(null, mappedArgs);\r\n  }\r\n\r\n  const computedContext = createContext({ readonly: true }, recompute());\r\n\r\n  return computedContext;\r\n}\r\n\r\nfunction createContext(options, data, methodCreator = defaultMethodCreator) {\r\n  const context = React.createContext(data);\r\n  const subscribers = [];\r\n  const methods =\r\n    typeof methodCreator === 'function'\r\n      ? methodCreator(accessor)\r\n      : methodCreator;\r\n  const wiredMethods = Object.entries(methods).reduce(\r\n    (wiredMethods, [name, method]) => {\r\n      wiredMethods[name] = function() {\r\n        const result = method.apply(null, arguments);\r\n        if (typeof result === 'function') {\r\n          accessor(result(data));\r\n          return;\r\n        }\r\n\r\n        return result;\r\n      };\r\n      return wiredMethods;\r\n    },\r\n    {}\r\n  );\r\n  /**\r\n   * define accessor for context\r\n   * accessor() => get ccurrent context value\r\n   * accessor(newValue) => set new value for current context\r\n   * accessor(subscriber) => register new subscription and return a func, call that func to unsubscribe subscription\r\n   */\r\n  function accessor(payload) {\r\n    if (!arguments.length) return data;\r\n    // subscribe\r\n    if (typeof payload === 'function') {\r\n      const subscriber = payload;\r\n      subscribers.push(subscriber);\r\n      return function() {\r\n        const index = subscribers.indexOf(subscriber);\r\n        if (index !== -1) {\r\n          subscribers.splice(index, 1);\r\n        }\r\n      };\r\n    }\r\n    if (payload === data) return;\r\n    data = payload;\r\n    accessor[dataProp] = createData(data, wiredMethods);\r\n    subscribers.forEach(subscriber => subscriber(data));\r\n  }\r\n\r\n  /**\r\n   * create simple HOC component and pass context value to specified prop name\r\n   */\r\n  function hoc(propName) {\r\n    return Object.assign(\r\n      Component => props =>\r\n        createElement(context.Consumer, {}, context =>\r\n          createElement(\r\n            Component,\r\n            propName\r\n              ? // passing context value as specified prop\r\n              { [propName]: context.value, ...props }\r\n              : // passing context value as props\r\n              context.value\r\n          )\r\n        ),\r\n      {\r\n        [isHoc]: true\r\n      }\r\n    );\r\n  }\r\n\r\n  return Object.assign(accessor, {\r\n    hoc,\r\n    // wire method\r\n    ...wiredMethods,\r\n    [isContext]: true,\r\n    [dataProp]: createData(data, wiredMethods),\r\n    [consumerProp]: context.Consumer,\r\n    [providerProp]: class extends React.Component {\r\n      constructor(props) {\r\n        super(props);\r\n        this.state = { context: accessor[dataProp] };\r\n        this.unsubscribe = accessor(newData => {\r\n          this.setState({ context: accessor[dataProp] });\r\n        });\r\n      }\r\n\r\n      componentWillUnmount() {\r\n        this.unsubscribe();\r\n      }\r\n\r\n      render() {\r\n        return createElement(\r\n          context.Provider,\r\n          { value: this.state.context },\r\n          this.props.children\r\n        );\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nexport function create() {\r\n  if (arguments[0] && arguments[0][isContext]) {\r\n    // create computed context\r\n    const contexts = [].slice.call(arguments);\r\n    return computed(contexts.pop(), contexts);\r\n  }\r\n\r\n  return createContext({}, arguments[0], arguments[1]);\r\n}\r\n\r\nfunction invoke(action, contexts, args) {\r\n  return action(...args)(...contexts.map(x => x[dataProp]));\r\n}\r\n\r\nfunction createHocOrAction(hoc, contexts) {\r\n  return Object.assign(\r\n    function() {\r\n      if (typeof arguments[0] !== 'function') {\r\n        // invoke action\r\n        return invoke(hoc, contexts, [].slice.call(arguments));\r\n      }\r\n\r\n      const component = arguments[0];\r\n      const args = [].slice.call(arguments, 1);\r\n\r\n      return connect(\r\n        contexts,\r\n        function(ownedProps) {\r\n          const contextData = [].slice.call(arguments, 1);\r\n          // render directly\r\n          return () => hoc(...args)(...contextData)(component, ownedProps);\r\n        }\r\n      );\r\n    },\r\n    {\r\n      [isHoc]: true,\r\n      [isAction]: true\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * compose all hocs\r\n */\r\nfunction compose(hocs) {\r\n  return function(component) {\r\n    return hocs.reduce((component, hoc) => hoc(component), component);\r\n  };\r\n}\r\n\r\n/**\r\n * compose multple contexts for creating Component/HocComponent/Action\r\n */\r\nexport function use(...contexts) {\r\n  if (contexts[0][isHoc]) {\r\n    return compose(contexts);\r\n  }\r\n  const Provider = contexts.reduce(\r\n    (Wrapper, context) => props =>\r\n      createElement(\r\n        Wrapper,\r\n        {},\r\n        createElement(context[providerProp], {}, props.children)\r\n      ),\r\n    props => props.children\r\n  );\r\n  return function() {\r\n    // use(...contexts) => HOC\r\n    if (typeof arguments[0] === 'function') {\r\n      // wrap component\r\n      if (arguments.length > 1) {\r\n        return connect(\r\n          contexts,\r\n          arguments[0],\r\n          arguments[1]\r\n        );\r\n      }\r\n\r\n      // wrap hoc\r\n      return createHocOrAction(arguments[0], contexts);\r\n    }\r\n    const props = arguments[0];\r\n    return createElement(Provider, {}, props.children);\r\n  };\r\n}\r\n\r\nexport function selector(...funcs) {\r\n  const lastFunc = funcs.pop();\r\n  let lastArgs, lastResult;\r\n  const wrapper = function(...args) {\r\n    if (shallowEqual(lastArgs, args)) {\r\n      return lastResult;\r\n    }\r\n    lastArgs = args;\r\n    return (lastResult = lastFunc.apply(null, args));\r\n  };\r\n\r\n  if (!funcs.length) {\r\n    return wrapper;\r\n  }\r\n\r\n  const argSelectors = funcs.map(x => selector(x));\r\n  return function(...args) {\r\n    const mappedArgs = argSelectors.map(x => x.apply(null, args));\r\n    return wrapper.apply(null, mappedArgs);\r\n  };\r\n}\r\n\r\nexport function shallowEqual(value1, value2, ignoreFuncs) {\r\n  if (value1 === value2) return true;\r\n  // compare date\r\n  if (value1 instanceof Date && value2 instanceof Date) {\r\n    return value1.getTime() === value2.getTime();\r\n  }\r\n  if (value1 && value2) {\r\n    if (Array.isArray(value1)) {\r\n      const length = value1.length;\r\n      if (length !== value2.length) return false;\r\n      for (let i = 0; i < length; i++) {\r\n        const value1Prop = value1[i];\r\n        const value2Prop = value2[i];\r\n        if (\r\n          ignoreFuncs &&\r\n          typeof value1Prop === 'function' &&\r\n          typeof value2Prop === 'function'\r\n        )\r\n          continue;\r\n        if (value1Prop !== value2Prop) return false;\r\n      }\r\n      return true;\r\n    }\r\n    const value1Keys = Object.keys(value1);\r\n    if (value1Keys.length !== Object.keys(value2).length) return false;\r\n    for (let key of value1Keys) {\r\n      const value1Prop = value1[key];\r\n      const value2Prop = value2[key];\r\n      if (\r\n        ignoreFuncs &&\r\n        typeof value1Prop === 'function' &&\r\n        typeof value2Prop === 'function'\r\n      )\r\n        continue;\r\n      if (value1Prop !== value2Prop) return false;\r\n    }\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function debounce(interval, callback) {\r\n  let timer;\r\n\r\n  return function() {\r\n    const args = arguments;\r\n    clearTimeout(timer);\r\n    timer = setTimeout(() => callback.apply(null, args), interval);\r\n  };\r\n}\r\n"]}